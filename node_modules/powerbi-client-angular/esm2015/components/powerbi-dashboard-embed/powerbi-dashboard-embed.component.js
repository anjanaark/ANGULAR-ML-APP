// Copyright (c) Microsoft Corporation.
// Licensed under the MIT License.
import { Component, Input, ViewChild } from '@angular/core';
import { PowerBIEmbedComponent } from '../powerbi-embed/powerbi-embed.component';
/**
 * Dashboard component to embed the dashboard, extends the Base component
 */
export class PowerBIDashboardEmbedComponent extends PowerBIEmbedComponent {
    constructor() {
        super();
    }
    // Getter for this._embed
    get embed() {
        return this._embed;
    }
    // Setter for this._embed
    set embed(newEmbedInstance) {
        this._embed = newEmbedInstance;
    }
    // Returns embed object to calling function
    getDashboard() {
        return this.embed;
    }
    ngOnInit() {
        // Initialize PowerBI service instance variable from parent
        super.ngOnInit();
    }
    ngOnChanges(changes) {
        if (changes.embedConfig) {
            const prevEmbedConfig = changes.embedConfig.previousValue;
            // Check if the function is being called for the first time
            if (!prevEmbedConfig) {
                return;
            }
            // Input from parent get updated, thus call embedOrUpdateDashboard function
            this.embedOrUpdateDashboard(prevEmbedConfig);
        }
        // Set event handlers if available
        if (this.eventHandlers && this.embed) {
            super.setEventHandlers(this.embed, this.eventHandlers);
        }
    }
    ngAfterViewInit() {
        // Check if container exists on the UI
        if (this.containerRef.nativeElement) {
            // Decide to embed or bootstrap
            if (this.embedConfig.accessToken && this.embedConfig.embedUrl) {
                this.embedDashboard();
            }
            else {
                this.embed = this.powerbi.bootstrap(this.containerRef.nativeElement, this.embedConfig);
            }
        }
        // Set event handlers if available
        if (this.eventHandlers && this.embed) {
            super.setEventHandlers(this.embed, this.eventHandlers);
        }
    }
    /**
     * Embed the PowerBI Dashboard
     *
     * @returns void
     */
    embedDashboard() {
        // Check if the HTML container is rendered and available
        if (!this.containerRef.nativeElement) {
            return;
        }
        this.embed = this.powerbi.embed(this.containerRef.nativeElement, this.embedConfig);
    }
    /**
     * When component updates, choose to _embed_ the powerbi dashboard
     * or do nothing if the embedUrl and accessToken did not update in the new properties
     *
     * @param prevEmbedConfig IDashboardEmbedConfiguration
     * @returns void
     */
    embedOrUpdateDashboard(prevEmbedConfig) {
        // Check if Embed URL and Access Token are present in current properties
        if (!this.embedConfig.accessToken || !this.embedConfig.embedUrl) {
            return;
        }
        // Embed in the following scenario
        // Embed URL is updated (E.g. New dashboard is to be embedded)
        if (this.containerRef.nativeElement && this.embedConfig.embedUrl !== prevEmbedConfig.embedUrl) {
            this.embedDashboard();
        }
    }
}
PowerBIDashboardEmbedComponent.decorators = [
    { type: Component, args: [{
                selector: 'powerbi-dashboard[embedConfig]',
                template: '<div class={{cssClassName}} #dashboardContainer></div>'
            },] }
];
PowerBIDashboardEmbedComponent.ctorParameters = () => [];
PowerBIDashboardEmbedComponent.propDecorators = {
    embedConfig: [{ type: Input }],
    eventHandlers: [{ type: Input }],
    containerRef: [{ type: ViewChild, args: ['dashboardContainer',] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG93ZXJiaS1kYXNoYm9hcmQtZW1iZWQuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vcG93ZXJiaS1jbGllbnQtYW5ndWxhci9zcmMvY29tcG9uZW50cy9wb3dlcmJpLWRhc2hib2FyZC1lbWJlZC9wb3dlcmJpLWRhc2hib2FyZC1lbWJlZC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsdUNBQXVDO0FBQ3ZDLGtDQUFrQztBQUVsQyxPQUFPLEVBQWlCLFNBQVMsRUFBYyxLQUFLLEVBQW9DLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUV6SCxPQUFPLEVBQWdCLHFCQUFxQixFQUFFLE1BQU0sMENBQTBDLENBQUM7QUFFL0Y7O0dBRUc7QUFLSCxNQUFNLE9BQU8sOEJBQStCLFNBQVEscUJBQXFCO0lBeUJ2RTtRQUNFLEtBQUssRUFBRSxDQUFDO0lBQ1YsQ0FBQztJQVpELHlCQUF5QjtJQUN6QixJQUFZLEtBQUs7UUFDZixPQUFPLElBQUksQ0FBQyxNQUFNLENBQUM7SUFDckIsQ0FBQztJQUVELHlCQUF5QjtJQUN6QixJQUFZLEtBQUssQ0FBQyxnQkFBbUM7UUFDbkQsSUFBSSxDQUFDLE1BQU0sR0FBRyxnQkFBZ0IsQ0FBQztJQUNqQyxDQUFDO0lBTUQsMkNBQTJDO0lBQzNDLFlBQVk7UUFDVixPQUFPLElBQUksQ0FBQyxLQUFrQixDQUFDO0lBQ2pDLENBQUM7SUFFRCxRQUFRO1FBQ04sMkRBQTJEO1FBQzNELEtBQUssQ0FBQyxRQUFRLEVBQUUsQ0FBQztJQUNuQixDQUFDO0lBRUQsV0FBVyxDQUFDLE9BQXNCO1FBQ2hDLElBQUksT0FBTyxDQUFDLFdBQVcsRUFBRTtZQUN2QixNQUFNLGVBQWUsR0FBRyxPQUFPLENBQUMsV0FBVyxDQUFDLGFBQTZDLENBQUM7WUFFMUYsMkRBQTJEO1lBQzNELElBQUksQ0FBQyxlQUFlLEVBQUU7Z0JBQ3BCLE9BQU87YUFDUjtZQUVELDJFQUEyRTtZQUMzRSxJQUFJLENBQUMsc0JBQXNCLENBQUMsZUFBZSxDQUFDLENBQUM7U0FDOUM7UUFFRCxrQ0FBa0M7UUFDbEMsSUFBSSxJQUFJLENBQUMsYUFBYSxJQUFJLElBQUksQ0FBQyxLQUFLLEVBQUU7WUFDcEMsS0FBSyxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1NBQ3hEO0lBQ0gsQ0FBQztJQUVELGVBQWU7UUFDYixzQ0FBc0M7UUFDdEMsSUFBSSxJQUFJLENBQUMsWUFBWSxDQUFDLGFBQWEsRUFBRTtZQUNuQywrQkFBK0I7WUFDL0IsSUFBSSxJQUFJLENBQUMsV0FBVyxDQUFDLFdBQVcsSUFBSSxJQUFJLENBQUMsV0FBVyxDQUFDLFFBQVEsRUFBRTtnQkFDN0QsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO2FBQ3ZCO2lCQUFNO2dCQUNMLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxhQUFhLEVBQUUsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO2FBQ3hGO1NBQ0Y7UUFFRCxrQ0FBa0M7UUFDbEMsSUFBSSxJQUFJLENBQUMsYUFBYSxJQUFJLElBQUksQ0FBQyxLQUFLLEVBQUU7WUFDcEMsS0FBSyxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1NBQ3hEO0lBQ0gsQ0FBQztJQUVEOzs7O09BSUc7SUFDSyxjQUFjO1FBQ3BCLHdEQUF3RDtRQUN4RCxJQUFJLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxhQUFhLEVBQUU7WUFDcEMsT0FBTztTQUNSO1FBRUQsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLGFBQWEsRUFBRSxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7SUFDckYsQ0FBQztJQUVEOzs7Ozs7T0FNRztJQUNLLHNCQUFzQixDQUFDLGVBQTZDO1FBQzFFLHdFQUF3RTtRQUN4RSxJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxXQUFXLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLFFBQVEsRUFBRTtZQUMvRCxPQUFPO1NBQ1I7UUFFRCxrQ0FBa0M7UUFDbEMsOERBQThEO1FBQzlELElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQyxhQUFhLElBQUksSUFBSSxDQUFDLFdBQVcsQ0FBQyxRQUFRLEtBQUssZUFBZSxDQUFDLFFBQVEsRUFBRTtZQUM3RixJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7U0FDdkI7SUFDSCxDQUFDOzs7WUEvR0YsU0FBUyxTQUFDO2dCQUNULFFBQVEsRUFBRSxnQ0FBZ0M7Z0JBQzFDLFFBQVEsRUFBRSx3REFBd0Q7YUFDbkU7Ozs7MEJBSUUsS0FBSzs0QkFHTCxLQUFLOzJCQUdMLFNBQVMsU0FBQyxvQkFBb0IiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi5cclxuLy8gTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLlxyXG5cclxuaW1wb3J0IHsgQWZ0ZXJWaWV3SW5pdCwgQ29tcG9uZW50LCBFbGVtZW50UmVmLCBJbnB1dCwgT25DaGFuZ2VzLCBPbkluaXQsIFNpbXBsZUNoYW5nZXMsIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBEYXNoYm9hcmQsIEVtYmVkLCBJRGFzaGJvYXJkRW1iZWRDb25maWd1cmF0aW9uIH0gZnJvbSAncG93ZXJiaS1jbGllbnQnO1xyXG5pbXBvcnQgeyBFdmVudEhhbmRsZXIsIFBvd2VyQklFbWJlZENvbXBvbmVudCB9IGZyb20gJy4uL3Bvd2VyYmktZW1iZWQvcG93ZXJiaS1lbWJlZC5jb21wb25lbnQnO1xyXG5cclxuLyoqXHJcbiAqIERhc2hib2FyZCBjb21wb25lbnQgdG8gZW1iZWQgdGhlIGRhc2hib2FyZCwgZXh0ZW5kcyB0aGUgQmFzZSBjb21wb25lbnRcclxuICovXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAncG93ZXJiaS1kYXNoYm9hcmRbZW1iZWRDb25maWddJyxcclxuICB0ZW1wbGF0ZTogJzxkaXYgY2xhc3M9e3tjc3NDbGFzc05hbWV9fSAjZGFzaGJvYXJkQ29udGFpbmVyPjwvZGl2PicsXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBQb3dlckJJRGFzaGJvYXJkRW1iZWRDb21wb25lbnQgZXh0ZW5kcyBQb3dlckJJRW1iZWRDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcywgQWZ0ZXJWaWV3SW5pdCB7XHJcbiAgLy8gSW5wdXQoKSBzcGVjaWZ5IHByb3BlcnRpZXMgdGhhdCB3aWxsIGJlIHBhc3NlZCBmcm9tIHBhcmVudFxyXG4gIC8vIENvbmZpZ3VyYXRpb24gZm9yIGVtYmVkZGluZyB0aGUgUG93ZXJCSSBEYXNoYm9hcmQgKFJlcXVpcmVkKVxyXG4gIEBJbnB1dCgpIGVtYmVkQ29uZmlnITogSURhc2hib2FyZEVtYmVkQ29uZmlndXJhdGlvbjtcclxuXHJcbiAgLy8gTWFwIG9mIGV2ZW50IG5hbWUgYW5kIGhhbmRsZXIgbWV0aG9kcyBwYWlycyB0byBiZSB0cmlnZ2VyZWQgb24gdGhlIGV2ZW50IChPcHRpb25hbClcclxuICBASW5wdXQoKSBldmVudEhhbmRsZXJzPzogTWFwPHN0cmluZywgRXZlbnRIYW5kbGVyIHwgbnVsbD47XHJcblxyXG4gIC8vIFJlZiB0byB0aGUgSFRNTCBkaXYgY29udGFpbmVyIGVsZW1lbnRcclxuICBAVmlld0NoaWxkKCdkYXNoYm9hcmRDb250YWluZXInKSBwcml2YXRlIGNvbnRhaW5lclJlZiE6IEVsZW1lbnRSZWY8SFRNTERpdkVsZW1lbnQ+O1xyXG5cclxuICAvLyBFbWJlZGRlZCBlbnRpdHlcclxuICAvLyBOb3RlOiBEbyBub3QgcmVhZCBvciBhc3NpZ24gdG8gdGhpcyBtZW1iZXIgdmFyaWFibGUgZGlyZWN0bHksIGluc3RlYWQgdXNlIHRoZSBnZXR0ZXIgYW5kIHNldHRlclxyXG4gIHByaXZhdGUgX2VtYmVkPzogRW1iZWQ7XHJcblxyXG4gIC8vIEdldHRlciBmb3IgdGhpcy5fZW1iZWRcclxuICBwcml2YXRlIGdldCBlbWJlZCgpOiBFbWJlZCB8IHVuZGVmaW5lZCB7XHJcbiAgICByZXR1cm4gdGhpcy5fZW1iZWQ7XHJcbiAgfVxyXG5cclxuICAvLyBTZXR0ZXIgZm9yIHRoaXMuX2VtYmVkXHJcbiAgcHJpdmF0ZSBzZXQgZW1iZWQobmV3RW1iZWRJbnN0YW5jZTogRW1iZWQgfCB1bmRlZmluZWQpIHtcclxuICAgIHRoaXMuX2VtYmVkID0gbmV3RW1iZWRJbnN0YW5jZTtcclxuICB9XHJcblxyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgc3VwZXIoKTtcclxuICB9XHJcblxyXG4gIC8vIFJldHVybnMgZW1iZWQgb2JqZWN0IHRvIGNhbGxpbmcgZnVuY3Rpb25cclxuICBnZXREYXNoYm9hcmQoKTogRGFzaGJvYXJkIHtcclxuICAgIHJldHVybiB0aGlzLmVtYmVkIGFzIERhc2hib2FyZDtcclxuICB9XHJcblxyXG4gIG5nT25Jbml0KCk6IHZvaWQge1xyXG4gICAgLy8gSW5pdGlhbGl6ZSBQb3dlckJJIHNlcnZpY2UgaW5zdGFuY2UgdmFyaWFibGUgZnJvbSBwYXJlbnRcclxuICAgIHN1cGVyLm5nT25Jbml0KCk7XHJcbiAgfVxyXG5cclxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKTogdm9pZCB7XHJcbiAgICBpZiAoY2hhbmdlcy5lbWJlZENvbmZpZykge1xyXG4gICAgICBjb25zdCBwcmV2RW1iZWRDb25maWcgPSBjaGFuZ2VzLmVtYmVkQ29uZmlnLnByZXZpb3VzVmFsdWUgYXMgSURhc2hib2FyZEVtYmVkQ29uZmlndXJhdGlvbjtcclxuXHJcbiAgICAgIC8vIENoZWNrIGlmIHRoZSBmdW5jdGlvbiBpcyBiZWluZyBjYWxsZWQgZm9yIHRoZSBmaXJzdCB0aW1lXHJcbiAgICAgIGlmICghcHJldkVtYmVkQ29uZmlnKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBJbnB1dCBmcm9tIHBhcmVudCBnZXQgdXBkYXRlZCwgdGh1cyBjYWxsIGVtYmVkT3JVcGRhdGVEYXNoYm9hcmQgZnVuY3Rpb25cclxuICAgICAgdGhpcy5lbWJlZE9yVXBkYXRlRGFzaGJvYXJkKHByZXZFbWJlZENvbmZpZyk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gU2V0IGV2ZW50IGhhbmRsZXJzIGlmIGF2YWlsYWJsZVxyXG4gICAgaWYgKHRoaXMuZXZlbnRIYW5kbGVycyAmJiB0aGlzLmVtYmVkKSB7XHJcbiAgICAgIHN1cGVyLnNldEV2ZW50SGFuZGxlcnModGhpcy5lbWJlZCwgdGhpcy5ldmVudEhhbmRsZXJzKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpOiB2b2lkIHtcclxuICAgIC8vIENoZWNrIGlmIGNvbnRhaW5lciBleGlzdHMgb24gdGhlIFVJXHJcbiAgICBpZiAodGhpcy5jb250YWluZXJSZWYubmF0aXZlRWxlbWVudCkge1xyXG4gICAgICAvLyBEZWNpZGUgdG8gZW1iZWQgb3IgYm9vdHN0cmFwXHJcbiAgICAgIGlmICh0aGlzLmVtYmVkQ29uZmlnLmFjY2Vzc1Rva2VuICYmIHRoaXMuZW1iZWRDb25maWcuZW1iZWRVcmwpIHtcclxuICAgICAgICB0aGlzLmVtYmVkRGFzaGJvYXJkKCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5lbWJlZCA9IHRoaXMucG93ZXJiaS5ib290c3RyYXAodGhpcy5jb250YWluZXJSZWYubmF0aXZlRWxlbWVudCwgdGhpcy5lbWJlZENvbmZpZyk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBTZXQgZXZlbnQgaGFuZGxlcnMgaWYgYXZhaWxhYmxlXHJcbiAgICBpZiAodGhpcy5ldmVudEhhbmRsZXJzICYmIHRoaXMuZW1iZWQpIHtcclxuICAgICAgc3VwZXIuc2V0RXZlbnRIYW5kbGVycyh0aGlzLmVtYmVkLCB0aGlzLmV2ZW50SGFuZGxlcnMpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRW1iZWQgdGhlIFBvd2VyQkkgRGFzaGJvYXJkXHJcbiAgICpcclxuICAgKiBAcmV0dXJucyB2b2lkXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBlbWJlZERhc2hib2FyZCgpOiB2b2lkIHtcclxuICAgIC8vIENoZWNrIGlmIHRoZSBIVE1MIGNvbnRhaW5lciBpcyByZW5kZXJlZCBhbmQgYXZhaWxhYmxlXHJcbiAgICBpZiAoIXRoaXMuY29udGFpbmVyUmVmLm5hdGl2ZUVsZW1lbnQpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuZW1iZWQgPSB0aGlzLnBvd2VyYmkuZW1iZWQodGhpcy5jb250YWluZXJSZWYubmF0aXZlRWxlbWVudCwgdGhpcy5lbWJlZENvbmZpZyk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBXaGVuIGNvbXBvbmVudCB1cGRhdGVzLCBjaG9vc2UgdG8gX2VtYmVkXyB0aGUgcG93ZXJiaSBkYXNoYm9hcmRcclxuICAgKiBvciBkbyBub3RoaW5nIGlmIHRoZSBlbWJlZFVybCBhbmQgYWNjZXNzVG9rZW4gZGlkIG5vdCB1cGRhdGUgaW4gdGhlIG5ldyBwcm9wZXJ0aWVzXHJcbiAgICpcclxuICAgKiBAcGFyYW0gcHJldkVtYmVkQ29uZmlnIElEYXNoYm9hcmRFbWJlZENvbmZpZ3VyYXRpb25cclxuICAgKiBAcmV0dXJucyB2b2lkXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBlbWJlZE9yVXBkYXRlRGFzaGJvYXJkKHByZXZFbWJlZENvbmZpZzogSURhc2hib2FyZEVtYmVkQ29uZmlndXJhdGlvbik6IHZvaWQge1xyXG4gICAgLy8gQ2hlY2sgaWYgRW1iZWQgVVJMIGFuZCBBY2Nlc3MgVG9rZW4gYXJlIHByZXNlbnQgaW4gY3VycmVudCBwcm9wZXJ0aWVzXHJcbiAgICBpZiAoIXRoaXMuZW1iZWRDb25maWcuYWNjZXNzVG9rZW4gfHwgIXRoaXMuZW1iZWRDb25maWcuZW1iZWRVcmwpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEVtYmVkIGluIHRoZSBmb2xsb3dpbmcgc2NlbmFyaW9cclxuICAgIC8vIEVtYmVkIFVSTCBpcyB1cGRhdGVkIChFLmcuIE5ldyBkYXNoYm9hcmQgaXMgdG8gYmUgZW1iZWRkZWQpXHJcbiAgICBpZiAodGhpcy5jb250YWluZXJSZWYubmF0aXZlRWxlbWVudCAmJiB0aGlzLmVtYmVkQ29uZmlnLmVtYmVkVXJsICE9PSBwcmV2RW1iZWRDb25maWcuZW1iZWRVcmwpIHtcclxuICAgICAgdGhpcy5lbWJlZERhc2hib2FyZCgpO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG4iXX0=