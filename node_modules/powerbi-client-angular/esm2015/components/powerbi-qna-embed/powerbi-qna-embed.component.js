// Copyright (c) Microsoft Corporation.
// Licensed under the MIT License.
import { Component, Input, ViewChild } from '@angular/core';
import { PowerBIEmbedComponent } from '../powerbi-embed/powerbi-embed.component';
/**
 * Qna component to embed the Qna visual, extends Base component
 */
export class PowerBIQnaEmbedComponent extends PowerBIEmbedComponent {
    constructor() {
        super();
    }
    // Getter for this._embed
    get embed() {
        return this._embed;
    }
    // Setter for this._embed
    set embed(newEmbedInstance) {
        this._embed = newEmbedInstance;
    }
    // Returns embed object to calling function
    getQna() {
        return this._embed;
    }
    ngOnInit() {
        // Initialize PowerBI service instance variable from parent
        super.ngOnInit();
    }
    ngOnChanges(changes) {
        if (changes.embedConfig) {
            const prevEmbedConfig = changes.embedConfig.previousValue;
            // Check if the function is being called for the first time
            if (!prevEmbedConfig) {
                return;
            }
            // Input from parent get updated, thus call embedOrUpdateDashboard function
            this.embedOrUpdateQna(prevEmbedConfig);
        }
        // Set event handlers if available
        if (this.eventHandlers && this.embed) {
            super.setEventHandlers(this.embed, this.eventHandlers);
        }
    }
    ngAfterViewInit() {
        // Check if container exists on the UI
        if (this.containerRef.nativeElement) {
            // Decide to embed or bootstrap
            if (this.embedConfig.accessToken && this.embedConfig.embedUrl) {
                this.embedQnaVisual();
            }
            else {
                this.embed = this.powerbi.bootstrap(this.containerRef.nativeElement, this.embedConfig);
            }
        }
        // Set event handlers if available
        if (this.eventHandlers && this.embed) {
            super.setEventHandlers(this.embed, this.eventHandlers);
        }
    }
    /**
     * Embed the PowerBI QnA Visual
     *
     * @returns void
     */
    embedQnaVisual() {
        // Check if the HTML container is rendered and available
        if (!this.containerRef.nativeElement) {
            return;
        }
        this.embed = this.powerbi.embed(this.containerRef.nativeElement, this.embedConfig);
    }
    /**
     * When component updates, choose to _embed_ the powerbi qna visual
     * or do nothing if the embedUrl and accessToken did not update in the new properties
     *
     * @param prevEmbedConfig IQnaEmbedConfiguration
     * @returns void
     */
    embedOrUpdateQna(prevEmbedConfig) {
        // Check if Embed URL and Access Token are present in current properties
        if (!this.embedConfig.accessToken || !this.embedConfig.embedUrl) {
            return;
        }
        // Embed in the following scenario
        // Embed URL is updated (E.g. New Qna visual is to be embedded)
        if (this.containerRef.nativeElement && this.embedConfig.embedUrl !== prevEmbedConfig.embedUrl) {
            this.embedQnaVisual();
        }
    }
}
PowerBIQnaEmbedComponent.decorators = [
    { type: Component, args: [{
                selector: 'powerbi-qna[embedConfig]',
                template: '<div class={{cssClassName}} #qnaContainer></div>'
            },] }
];
PowerBIQnaEmbedComponent.ctorParameters = () => [];
PowerBIQnaEmbedComponent.propDecorators = {
    embedConfig: [{ type: Input }],
    eventHandlers: [{ type: Input }],
    containerRef: [{ type: ViewChild, args: ['qnaContainer',] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG93ZXJiaS1xbmEtZW1iZWQuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vcG93ZXJiaS1jbGllbnQtYW5ndWxhci9zcmMvY29tcG9uZW50cy9wb3dlcmJpLXFuYS1lbWJlZC9wb3dlcmJpLXFuYS1lbWJlZC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsdUNBQXVDO0FBQ3ZDLGtDQUFrQztBQUVsQyxPQUFPLEVBQWlCLFNBQVMsRUFBYyxLQUFLLEVBQW9DLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUV6SCxPQUFPLEVBQWdCLHFCQUFxQixFQUFFLE1BQU0sMENBQTBDLENBQUM7QUFFL0Y7O0dBRUc7QUFLSCxNQUFNLE9BQU8sd0JBQXlCLFNBQVEscUJBQXFCO0lBeUJqRTtRQUNFLEtBQUssRUFBRSxDQUFDO0lBQ1YsQ0FBQztJQVpELHlCQUF5QjtJQUN6QixJQUFZLEtBQUs7UUFDZixPQUFPLElBQUksQ0FBQyxNQUFNLENBQUM7SUFDckIsQ0FBQztJQUVELHlCQUF5QjtJQUN6QixJQUFZLEtBQUssQ0FBQyxnQkFBbUM7UUFDbkQsSUFBSSxDQUFDLE1BQU0sR0FBRyxnQkFBZ0IsQ0FBQztJQUNqQyxDQUFDO0lBTUQsMkNBQTJDO0lBQzNDLE1BQU07UUFDSixPQUFPLElBQUksQ0FBQyxNQUFhLENBQUM7SUFDNUIsQ0FBQztJQUVELFFBQVE7UUFDTiwyREFBMkQ7UUFDM0QsS0FBSyxDQUFDLFFBQVEsRUFBRSxDQUFDO0lBQ25CLENBQUM7SUFFRCxXQUFXLENBQUMsT0FBc0I7UUFDaEMsSUFBSSxPQUFPLENBQUMsV0FBVyxFQUFFO1lBQ3ZCLE1BQU0sZUFBZSxHQUFHLE9BQU8sQ0FBQyxXQUFXLENBQUMsYUFBdUMsQ0FBQztZQUVwRiwyREFBMkQ7WUFDM0QsSUFBSSxDQUFDLGVBQWUsRUFBRTtnQkFDcEIsT0FBTzthQUNSO1lBRUQsMkVBQTJFO1lBQzNFLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxlQUFlLENBQUMsQ0FBQztTQUN4QztRQUVELGtDQUFrQztRQUNsQyxJQUFJLElBQUksQ0FBQyxhQUFhLElBQUksSUFBSSxDQUFDLEtBQUssRUFBRTtZQUNwQyxLQUFLLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUM7U0FDeEQ7SUFDSCxDQUFDO0lBRUQsZUFBZTtRQUNiLHNDQUFzQztRQUN0QyxJQUFJLElBQUksQ0FBQyxZQUFZLENBQUMsYUFBYSxFQUFFO1lBQ25DLCtCQUErQjtZQUMvQixJQUFJLElBQUksQ0FBQyxXQUFXLENBQUMsV0FBVyxJQUFJLElBQUksQ0FBQyxXQUFXLENBQUMsUUFBUSxFQUFFO2dCQUM3RCxJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7YUFDdkI7aUJBQU07Z0JBQ0wsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLGFBQWEsRUFBRSxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7YUFDeEY7U0FDRjtRQUVELGtDQUFrQztRQUNsQyxJQUFJLElBQUksQ0FBQyxhQUFhLElBQUksSUFBSSxDQUFDLEtBQUssRUFBRTtZQUNwQyxLQUFLLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUM7U0FDeEQ7SUFDSCxDQUFDO0lBRUQ7Ozs7T0FJRztJQUNLLGNBQWM7UUFDcEIsd0RBQXdEO1FBQ3hELElBQUksQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLGFBQWEsRUFBRTtZQUNwQyxPQUFPO1NBQ1I7UUFFRCxJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsYUFBYSxFQUFFLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztJQUNyRixDQUFDO0lBRUQ7Ozs7OztPQU1HO0lBQ0ssZ0JBQWdCLENBQUMsZUFBdUM7UUFDOUQsd0VBQXdFO1FBQ3hFLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLFdBQVcsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsUUFBUSxFQUFFO1lBQy9ELE9BQU87U0FDUjtRQUVELGtDQUFrQztRQUNsQywrREFBK0Q7UUFDL0QsSUFBSSxJQUFJLENBQUMsWUFBWSxDQUFDLGFBQWEsSUFBSSxJQUFJLENBQUMsV0FBVyxDQUFDLFFBQVEsS0FBSyxlQUFlLENBQUMsUUFBUSxFQUFFO1lBQzdGLElBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQztTQUN2QjtJQUNILENBQUM7OztZQS9HRixTQUFTLFNBQUM7Z0JBQ1QsUUFBUSxFQUFFLDBCQUEwQjtnQkFDcEMsUUFBUSxFQUFFLGtEQUFrRDthQUM3RDs7OzswQkFJRSxLQUFLOzRCQUdMLEtBQUs7MkJBR0wsU0FBUyxTQUFDLGNBQWMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi5cclxuLy8gTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLlxyXG5cclxuaW1wb3J0IHsgQWZ0ZXJWaWV3SW5pdCwgQ29tcG9uZW50LCBFbGVtZW50UmVmLCBJbnB1dCwgT25DaGFuZ2VzLCBPbkluaXQsIFNpbXBsZUNoYW5nZXMsIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBFbWJlZCwgSVFuYUVtYmVkQ29uZmlndXJhdGlvbiwgUW5hIH0gZnJvbSAncG93ZXJiaS1jbGllbnQnO1xyXG5pbXBvcnQgeyBFdmVudEhhbmRsZXIsIFBvd2VyQklFbWJlZENvbXBvbmVudCB9IGZyb20gJy4uL3Bvd2VyYmktZW1iZWQvcG93ZXJiaS1lbWJlZC5jb21wb25lbnQnO1xyXG5cclxuLyoqXHJcbiAqIFFuYSBjb21wb25lbnQgdG8gZW1iZWQgdGhlIFFuYSB2aXN1YWwsIGV4dGVuZHMgQmFzZSBjb21wb25lbnRcclxuICovXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAncG93ZXJiaS1xbmFbZW1iZWRDb25maWddJyxcclxuICB0ZW1wbGF0ZTogJzxkaXYgY2xhc3M9e3tjc3NDbGFzc05hbWV9fSAjcW5hQ29udGFpbmVyPjwvZGl2PicsXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBQb3dlckJJUW5hRW1iZWRDb21wb25lbnQgZXh0ZW5kcyBQb3dlckJJRW1iZWRDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcywgQWZ0ZXJWaWV3SW5pdCB7XHJcbiAgLy8gSW5wdXQoKSBzcGVjaWZ5IHByb3BlcnRpZXMgdGhhdCB3aWxsIGJlIHBhc3NlZCBmcm9tIHBhcmVudFxyXG4gIC8vIENvbmZpZ3VyYXRpb24gZm9yIGVtYmVkZGluZyB0aGUgUG93ZXJCSSBRbmEgdmlzdWFsIChSZXF1aXJlZClcclxuICBASW5wdXQoKSBlbWJlZENvbmZpZyE6IElRbmFFbWJlZENvbmZpZ3VyYXRpb247XHJcblxyXG4gIC8vIE1hcCBvZiBldmVudCBuYW1lIGFuZCBoYW5kbGVyIG1ldGhvZHMgcGFpcnMgdG8gYmUgdHJpZ2dlcmVkIG9uIHRoZSBldmVudCAoT3B0aW9uYWwpXHJcbiAgQElucHV0KCkgZXZlbnRIYW5kbGVycz86IE1hcDxzdHJpbmcsIEV2ZW50SGFuZGxlciB8IG51bGw+O1xyXG5cclxuICAvLyBSZWYgdG8gdGhlIEhUTUwgZGl2IGNvbnRhaW5lciBlbGVtZW50XHJcbiAgQFZpZXdDaGlsZCgncW5hQ29udGFpbmVyJykgcHJpdmF0ZSBjb250YWluZXJSZWYhOiBFbGVtZW50UmVmPEhUTUxEaXZFbGVtZW50PjtcclxuXHJcbiAgLy8gRW1iZWRkZWQgZW50aXR5XHJcbiAgLy8gTm90ZTogRG8gbm90IHJlYWQgb3IgYXNzaWduIHRvIHRoaXMgbWVtYmVyIHZhcmlhYmxlIGRpcmVjdGx5LCBpbnN0ZWFkIHVzZSB0aGUgZ2V0dGVyIGFuZCBzZXR0ZXJcclxuICBwcml2YXRlIF9lbWJlZD86IEVtYmVkO1xyXG5cclxuICAvLyBHZXR0ZXIgZm9yIHRoaXMuX2VtYmVkXHJcbiAgcHJpdmF0ZSBnZXQgZW1iZWQoKTogRW1iZWQgfCB1bmRlZmluZWQge1xyXG4gICAgcmV0dXJuIHRoaXMuX2VtYmVkO1xyXG4gIH1cclxuXHJcbiAgLy8gU2V0dGVyIGZvciB0aGlzLl9lbWJlZFxyXG4gIHByaXZhdGUgc2V0IGVtYmVkKG5ld0VtYmVkSW5zdGFuY2U6IEVtYmVkIHwgdW5kZWZpbmVkKSB7XHJcbiAgICB0aGlzLl9lbWJlZCA9IG5ld0VtYmVkSW5zdGFuY2U7XHJcbiAgfVxyXG5cclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHN1cGVyKCk7XHJcbiAgfVxyXG5cclxuICAvLyBSZXR1cm5zIGVtYmVkIG9iamVjdCB0byBjYWxsaW5nIGZ1bmN0aW9uXHJcbiAgZ2V0UW5hKCk6IFFuYSB7XHJcbiAgICByZXR1cm4gdGhpcy5fZW1iZWQgYXMgUW5hO1xyXG4gIH1cclxuXHJcbiAgbmdPbkluaXQoKTogdm9pZCB7XHJcbiAgICAvLyBJbml0aWFsaXplIFBvd2VyQkkgc2VydmljZSBpbnN0YW5jZSB2YXJpYWJsZSBmcm9tIHBhcmVudFxyXG4gICAgc3VwZXIubmdPbkluaXQoKTtcclxuICB9XHJcblxyXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpOiB2b2lkIHtcclxuICAgIGlmIChjaGFuZ2VzLmVtYmVkQ29uZmlnKSB7XHJcbiAgICAgIGNvbnN0IHByZXZFbWJlZENvbmZpZyA9IGNoYW5nZXMuZW1iZWRDb25maWcucHJldmlvdXNWYWx1ZSBhcyBJUW5hRW1iZWRDb25maWd1cmF0aW9uO1xyXG5cclxuICAgICAgLy8gQ2hlY2sgaWYgdGhlIGZ1bmN0aW9uIGlzIGJlaW5nIGNhbGxlZCBmb3IgdGhlIGZpcnN0IHRpbWVcclxuICAgICAgaWYgKCFwcmV2RW1iZWRDb25maWcpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIElucHV0IGZyb20gcGFyZW50IGdldCB1cGRhdGVkLCB0aHVzIGNhbGwgZW1iZWRPclVwZGF0ZURhc2hib2FyZCBmdW5jdGlvblxyXG4gICAgICB0aGlzLmVtYmVkT3JVcGRhdGVRbmEocHJldkVtYmVkQ29uZmlnKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBTZXQgZXZlbnQgaGFuZGxlcnMgaWYgYXZhaWxhYmxlXHJcbiAgICBpZiAodGhpcy5ldmVudEhhbmRsZXJzICYmIHRoaXMuZW1iZWQpIHtcclxuICAgICAgc3VwZXIuc2V0RXZlbnRIYW5kbGVycyh0aGlzLmVtYmVkLCB0aGlzLmV2ZW50SGFuZGxlcnMpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgbmdBZnRlclZpZXdJbml0KCk6IHZvaWQge1xyXG4gICAgLy8gQ2hlY2sgaWYgY29udGFpbmVyIGV4aXN0cyBvbiB0aGUgVUlcclxuICAgIGlmICh0aGlzLmNvbnRhaW5lclJlZi5uYXRpdmVFbGVtZW50KSB7XHJcbiAgICAgIC8vIERlY2lkZSB0byBlbWJlZCBvciBib290c3RyYXBcclxuICAgICAgaWYgKHRoaXMuZW1iZWRDb25maWcuYWNjZXNzVG9rZW4gJiYgdGhpcy5lbWJlZENvbmZpZy5lbWJlZFVybCkge1xyXG4gICAgICAgIHRoaXMuZW1iZWRRbmFWaXN1YWwoKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLmVtYmVkID0gdGhpcy5wb3dlcmJpLmJvb3RzdHJhcCh0aGlzLmNvbnRhaW5lclJlZi5uYXRpdmVFbGVtZW50LCB0aGlzLmVtYmVkQ29uZmlnKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIFNldCBldmVudCBoYW5kbGVycyBpZiBhdmFpbGFibGVcclxuICAgIGlmICh0aGlzLmV2ZW50SGFuZGxlcnMgJiYgdGhpcy5lbWJlZCkge1xyXG4gICAgICBzdXBlci5zZXRFdmVudEhhbmRsZXJzKHRoaXMuZW1iZWQsIHRoaXMuZXZlbnRIYW5kbGVycyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBFbWJlZCB0aGUgUG93ZXJCSSBRbkEgVmlzdWFsXHJcbiAgICpcclxuICAgKiBAcmV0dXJucyB2b2lkXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBlbWJlZFFuYVZpc3VhbCgpOiB2b2lkIHtcclxuICAgIC8vIENoZWNrIGlmIHRoZSBIVE1MIGNvbnRhaW5lciBpcyByZW5kZXJlZCBhbmQgYXZhaWxhYmxlXHJcbiAgICBpZiAoIXRoaXMuY29udGFpbmVyUmVmLm5hdGl2ZUVsZW1lbnQpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuZW1iZWQgPSB0aGlzLnBvd2VyYmkuZW1iZWQodGhpcy5jb250YWluZXJSZWYubmF0aXZlRWxlbWVudCwgdGhpcy5lbWJlZENvbmZpZyk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBXaGVuIGNvbXBvbmVudCB1cGRhdGVzLCBjaG9vc2UgdG8gX2VtYmVkXyB0aGUgcG93ZXJiaSBxbmEgdmlzdWFsXHJcbiAgICogb3IgZG8gbm90aGluZyBpZiB0aGUgZW1iZWRVcmwgYW5kIGFjY2Vzc1Rva2VuIGRpZCBub3QgdXBkYXRlIGluIHRoZSBuZXcgcHJvcGVydGllc1xyXG4gICAqXHJcbiAgICogQHBhcmFtIHByZXZFbWJlZENvbmZpZyBJUW5hRW1iZWRDb25maWd1cmF0aW9uXHJcbiAgICogQHJldHVybnMgdm9pZFxyXG4gICAqL1xyXG4gIHByaXZhdGUgZW1iZWRPclVwZGF0ZVFuYShwcmV2RW1iZWRDb25maWc6IElRbmFFbWJlZENvbmZpZ3VyYXRpb24pOiB2b2lkIHtcclxuICAgIC8vIENoZWNrIGlmIEVtYmVkIFVSTCBhbmQgQWNjZXNzIFRva2VuIGFyZSBwcmVzZW50IGluIGN1cnJlbnQgcHJvcGVydGllc1xyXG4gICAgaWYgKCF0aGlzLmVtYmVkQ29uZmlnLmFjY2Vzc1Rva2VuIHx8ICF0aGlzLmVtYmVkQ29uZmlnLmVtYmVkVXJsKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICAvLyBFbWJlZCBpbiB0aGUgZm9sbG93aW5nIHNjZW5hcmlvXHJcbiAgICAvLyBFbWJlZCBVUkwgaXMgdXBkYXRlZCAoRS5nLiBOZXcgUW5hIHZpc3VhbCBpcyB0byBiZSBlbWJlZGRlZClcclxuICAgIGlmICh0aGlzLmNvbnRhaW5lclJlZi5uYXRpdmVFbGVtZW50ICYmIHRoaXMuZW1iZWRDb25maWcuZW1iZWRVcmwgIT09IHByZXZFbWJlZENvbmZpZy5lbWJlZFVybCkge1xyXG4gICAgICB0aGlzLmVtYmVkUW5hVmlzdWFsKCk7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcbiJdfQ==